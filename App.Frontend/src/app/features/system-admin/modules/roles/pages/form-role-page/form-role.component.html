<!-- Header Section -->
<div class="d-flex flex-wrap align-items-center justify-content-between mb-3 gap-3">

  <!-- Title + Subtitle -->
  <div class="flex-grow-1 min-w-200">
    <h1 class="fw-bold fs-6 mb-1">
      {{
      isEditMode
      ? ('form.editTitle' | translate)
      : ('form.createTitle' | translate)
      }}
    </h1>

    <p class="small text-secondary mb-0 fw-normal">
      {{
      isEditMode
      ? ('form.editSubtitle' | translate)
      : ('form.createSubtitle' | translate)
      }}
    </p>
  </div>
</div>

<!-- Form -->
<form [formGroup]="form" (ngSubmit)="onSubmit()" class="create-role-form">

  <!-- Role Name -->
  <div class="mb-3">
    <label for="name" class="form-label">
      {{ 'form.roleName' | translate }}
      <span class="text-danger">*</span>
    </label>

    <input type="text" id="name" formControlName="name" class="form-control form-control-sm"
      [placeholder]="'form.roleNamePlaceholder' | translate"
      [class.is-invalid]="form.get('name')?.invalid && form.get('name')?.touched" />

    <app-error [control]="formRoleName"></app-error>
  </div>

  <!-- Permissions -->
  <div class="mb-3">
    <label class="form-label">
      {{ 'form.permissions' | translate }}
      <span class="text-danger">*</span>
    </label>

    <div formArrayName="permissions" class="row g-2">
      <div *ngFor="let group of groupedPermissions; let groupIndex = index" class="col-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center" (click)="toggleGroup(groupIndex)">
            <span class="toggle-icon" [class.expanded]="group.expanded">â–¶</span>
            <span class="fw-medium">{{ group.groupName | titlecase }}</span>
            <span class="badge bg-light border text-muted">
              ({{ group.items.length }})
            </span>
          </div>

          <div class="card-body p-2" [class.d-none]="!group.expanded" >
            <div class="row g-2">
              <div *ngFor="let item of group.items; let itemIndex = index" class="col-12 col-sm-6 col-md-4">
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" [id]="'permission-' + item.value"
                    [formControlName]="getGroupPermissionIndex(groupIndex) + itemIndex" />
                  <label class="form-check-label small" [for]="'permission-' + item.value">
                    {{ item.label }}
                    <small class="text-muted">
                      ({{ item.value }})
                    </small>
                  </label>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div *ngIf="permissionsFormArray.invalid && permissionsFormArray.touched" class="text-danger small mt-1">
      {{ 'form.permissionsValidation' | translate }}
    </div>
  </div>

  <!-- Actions -->
  <div class="d-flex gap-2 justify-content-end">
    <button type="submit" class="btn btn-primary btn-sm">
      {{
      isEditMode
      ? ('form.submitUpdate' | translate)
      : ('form.submitCreate' | translate)
      }}
    </button>

    <button type="button" class="btn btn-secondary btn-sm" (click)="onCancel()">
      {{ 'form.cancel' | translate }}
    </button>
  </div>

</form>
